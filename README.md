# MIE424: Implementation and Evaluation of Different Loss Functions on Imbalanced Dataset for Multi-Class Classification

This README file details how the code can be set up, run, and figures/tables in the report can be reproduced

## Running Environment

It's recommended to use colab to execute the main project code to prevent any library compatibity issue and to reproduce more accurate performance metrics(The training time heavily depends on the GPU performance. And the GPU offered by colab pro is Tesla T4/P100 GPU ).

The project folder can be accessed publicly through the following link:
[Project Folder Google Drive](https://drive.google.com/drive/folders/1QCCQNiR2HwddjqQmZWER8z_PyrFf_E5x?usp=sharing)
* Here is the address in case the link above does not work:
  https://drive.google.com/drive/folders/1QCCQNiR2HwddjqQmZWER8z_PyrFf_E5x?usp=sharing

The code can be ran locally with following library setup:
* Note: to run it in local, make sure pytorch CUDA is enabled in the local environment.
```python
python==3.7.10
torch==1.8.1+cu101
torchsummary==1.5.1
torchvision==0.9.1+cu101
matplotlib==3.2.2
numpy==1.19.5
sklearn==0.0
sklearn-pandas==1.8.0
seaborn==0.11.1
pandas==1.1.5
```

## Requirment for Folder Structure

To run the code properly, the following folder structure needs to be maintained:

```python
.
├── model_output # This folder contains all of progress performance metrics and trained model for the main project code 
├── cropped_img # This is cropped image which is generated by CroppingAnnotatedImg.py
│   └── without_mask
│   └── with_mask
│   └── mask_weared_incorrectly
├── CIFAR_10_Testing # This folder will keep the cache for CIFAR_10 testing data for faster training, the dataset can be download from the google drive shared folder
│   ├── cifar-10-batches-py
├── CIFAR_10 # This folder will keep the cache for CIFAR_10 training data for faster training, the dataset can be download from the google drive shared folder
│   ├── cifar-10-batches-py
├── MIE424_ProjectCode.ipynb # Main Project Code
├── CroppingAnnotatedImg.zip # This folder contains code to generate cropped image for the Kaggle face mask dataset which is not required to run the main project code.
```

## Usage
The main project contains the following sections which can be ran in order:
1. Data Loader (Define general data loader)
2. Model Building (LeNet 5)
3. Training Code (Helper functions for training output, plotting curves and save progress)
4. Hyperparameter Tuning (To determine the base hyperparameter setup)
5. Loss Function (Our loss function implementation)
6. Model Training (The actual model training for face mask data)
7. Loss Function Evaluation (Loss function evaluations - Face Mask Data)
8. Test on CIFAR-10 LT (Contains helper functions to utilize CIFAR10_LT dataset)
9. CIFAR 10 Evaluation Results (Loss function evaluations - CIFAR10_LT)


* To run it in colab:
  * Change the runtime type to "GPU"
  * Run all
  * Note: The processing time might be long if colab pro is not subscribed.


* To run it in local environment: 
  * Through IDE(It's highly recommended to run the code in PyCharm. Because running through command line might not be able to see all of visualization properly):
  ```python
  Ctrl + Shift + F10 #use this command in the pycharm to run all
  ``` 
  * Through command line:
  ```python
  python3 mie424_projectcode.py
  ```
